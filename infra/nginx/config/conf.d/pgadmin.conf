server {
    listen 80;
    server_name 91.107.120.205;

    location /pgadmin/ {
        proxy_pass http://pgadmin4:80/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Script-Name /pgadmin;
        proxy_set_header X-Frame-Options SAMEORIGIN;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
        proxy_pass_request_headers on;

        proxy_read_timeout 90;
        proxy_redirect default;
        proxy_redirect http://pgadmin4:80/ /pgadmin/;

        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0";
        add_header Pragma "no-cache";
        add_header Expires 0;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        sub_filter_once off;
        sub_filter 'href="/' 'href="/pgadmin/';
        sub_filter 'src="/' 'src="/pgadmin/';
        sub_filter 'action="/' 'action="/pgadmin/';
    }

    location /login {
        proxy_pass http://pgadmin4:80/login;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /logout {
        proxy_pass http://pgadmin4:80/logout;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /browser/ {
        proxy_pass http://pgadmin4:80/browser/;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /tools/ {
        proxy_pass http://pgadmin4:80/tools/;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /authenticate/ {
        proxy_pass http://pgadmin4:80/authenticate/;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /static/ {
        proxy_pass http://pgadmin4:80/static/;
        add_header Content-Type text/css;
    }

    location /user_management/ {
        proxy_pass http://pgadmin4:80/user_management/;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /preferences/ {
        proxy_pass http://pgadmin4:80/preferences/;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /misc/ {
        proxy_pass http://pgadmin4:80/misc/;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /browser/check_corrupted_db_file {
        proxy_pass http://pgadmin4:80/browser/check_corrupted_db_file;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    location /misc/heartbeat/log {
        proxy_pass http://pgadmin4:80/misc/heartbeat/log;
        proxy_set_header Cookie $http_cookie;
        proxy_set_header Authorization $http_authorization;
    }

    error_log /var/log/nginx/pgadmin_error.log error;
    access_log /var/log/nginx/pgadmin_access.log;
}
